<link rel='stylesheet' href='css/softphone.css'/>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">AloTech</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav">
      <a class="nav-item nav-link active" href="#">Main<span class="sr-only">(current)</span></a>
      <a class="nav-item nav-link" href="#">Leads</a>
      <a class="nav-item nav-link" href="#">Customers</a>
      <a class="nav-item nav-link" href="#">Contacts</a>
      <a class="nav-item nav-link" href="#"><%= username %></a>   
    </div>
  </div>
</nav>

<div class="container" ng-app="myApp" ng-controller="myCtrl" style="padding-top: 50px;">
  <div class="row">
    <div class="col-md-8 order-md-1">
      <div class="row">
        <div class="col-md-6 mb-3">
          <input readonly name="number" type="text" class="form-control" id="number" placeholder="" value="" ng-model="customerName">
        </div>
        <div class="col-md-6 mb-3">
          <input name="customerPhone" readonly name="number" type="text" class="form-control" id="number" placeholder="" value="" ng-model="customerPhone">
        </div>
      </div>
      <hr class="mb-4">
      <a class="btn btn-success btn-lg btn-block text-white" ng-click="Click2Call()">Click2Call</a>       
    </div>
  </div>

  <div class="row" style="padding-top: 50px;">
    <div class="col-8">
      <div class="list-group" id="list-tab" role="tablist">
        <a ng-click="getDetailCustomer1()" class="list-group-item list-group-item-action" id="list-home-list" data-toggle="list" href="#list-home" role="tab" aria-controls="home">Ilker</a>
        <a ng-click="getDetailCustomer2()" class="list-group-item list-group-item-action" id="list-profile-list" data-toggle="list" href="#list-profile" role="tab" aria-controls="profile">Fatih</a>
      </div>
    </div>
  </div>
</div>

<script>
var app = angular.module('myApp', []);
app.controller('myCtrl', function($scope) {
    $scope.customer1 = "Ilker";
    $scope.customer2 = "Fatih";

    $scope.getDetailCustomer1 = function() {
      $scope.customerName = "Ilker";
      $scope.customerPhone = "05453671355";
    }
    $scope.getDetailCustomer2 = function() {
      $scope.customerName = "Fatih";
      $scope.customerPhone = "05071303066";
    }

    $scope.Click2Call = function() {
      let phone =  $scope.customerPhone;
      let session = getCookie("aloTechSession");
      
      let url = "http://smartkontak.musterihizmetleri.com/api/?function=click2call&phonenumber="+ phone +"&session="+ session;
      console.log(url);
      
      var http = new XMLHttpRequest();

      http.onreadystatechange = function() {
        if(http.readyState == 4){
          if(http.status == 200){
            alert("Click2Call isteği başarılı!");
          }else if(http.status == 404){
            alert("Click2Call isteği başarısız! Hatalı Session!");
          }
        }
      };

      http.open("GET", url, true);
      http.send();
    }
});
</script>


<iframe id="alotechiframe" scrolling="yes" allow="camera *; geolocation *; microphone *" src="https://softphone.alo-tech.com/generic/" scrolling="no"></iframe>
<script>
  function elle(){
    alert('elle tetiklendim.');
  }
  
  function onmessage(e) {
  var event = JSON.parse(e.data);
  console.log(event);
  }
  window.addEventListener('message', onmessage, false);

  function getCookie(cname) {
      var name = cname + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      var ca = decodedCookie.split(';');
      for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
  }
</script>

